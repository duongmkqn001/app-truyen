<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·∫£i l√™n truy·ªán - App Truy·ªán</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="css/theme-variables.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <a href="index.html" class="text-2xl font-bold text-green-600">üìö App Truy·ªán</a>
                
                <div class="flex items-center gap-4">
                    <a href="index.html" class="text-gray-700 hover:text-green-600">Trang ch·ªß</a>
                    <a href="authors.html" class="text-gray-700 hover:text-green-600">T√°c gi·∫£</a>
                    <a href="search-by-tag.html" class="text-gray-700 hover:text-green-600">T√¨m theo th·ªÉ lo·∫°i</a>
                    <a href="ranking.html" class="text-gray-700 hover:text-green-600">B·∫£ng x·∫øp h·∫°ng</a>
                    <a href="my-reading-list.html" class="text-gray-700 hover:text-green-600">üìñ Danh s√°ch ƒë·ªçc</a>
                    <a href="upload.html" class="text-green-600 font-semibold">T·∫£i l√™n</a>

                    <!-- User Menu -->
                    <div id="userMenu"></div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">üì§ T·∫£i l√™n truy·ªán</h1>
            
            <!-- Tab Navigation -->
            <div class="flex border-b border-gray-200 mb-6">
                <button id="manualTab" class="tab-btn px-6 py-3 font-semibold text-green-600 border-b-2 border-green-600">
                    Th√™m th·ªß c√¥ng
                </button>
                <button id="csvTab" class="tab-btn px-6 py-3 font-semibold text-gray-500 hover:text-green-600">
                    T·∫£i l√™n CSV
                </button>
            </div>

            <!-- Manual Upload Form -->
            <div id="manualUploadSection">
                <form id="manualUploadForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√™n truy·ªán *</label>
                        <input type="text" name="title" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√°c gi·∫£ *</label>
                        <input type="text" name="author_name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Editor/D·ªãch gi·∫£</label>
                        <input type="text" name="editor_name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">S·ªë ch∆∞∆°ng</label>
                            <input type="number" name="chapter_count" min="0" value="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ngo·∫°i truy·ªán</label>
                            <input type="number" name="extra_chapters" min="0" value="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√≥m t·∫Øt</label>
                        <textarea name="summary" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Link ƒë·ªçc truy·ªán</label>
                        <input type="url" name="novel_url" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Link ·∫£nh b√¨a</label>
                        <input type="url" name="cover_image_url" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tr·∫°ng th√°i *</label>
                        <select name="status" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <option value="ƒêang ra">ƒêang ra</option>
                            <option value="Ho√†n th√†nh">Ho√†n th√†nh</option>
                            <option value="T·∫°m ng∆∞ng">T·∫°m ng∆∞ng</option>
                        </select>
                    </div>

                    <!-- Tags Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Th·ªÉ lo·∫°i</label>
                        <p class="text-xs text-gray-500 mb-2">Ch·ªçn c√°c th·ªÉ lo·∫°i ph√π h·ª£p v·ªõi truy·ªán (ch·ªâ ch·ªçn t·ª´ danh s√°ch c√≥ s·∫µn)</p>

                        <!-- Selected Tags Display -->
                        <div id="selectedTagsDisplay" class="flex flex-wrap gap-2 mb-3 p-3 border border-gray-200 rounded-lg min-h-[60px] bg-gray-50">
                            <span class="text-gray-400 text-sm" id="noTagsPlaceholder">Ch∆∞a ch·ªçn th·ªÉ lo·∫°i n√†o</span>
                        </div>

                        <!-- Tag Picker Dropdown -->
                        <div class="relative">
                            <button type="button" id="tagPickerBtn" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-left flex items-center justify-between hover:border-green-500 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <span class="text-gray-700">Ch·ªçn th·ªÉ lo·∫°i...</span>
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>

                            <!-- Dropdown Menu -->
                            <div id="tagPickerDropdown" class="hidden absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-64 overflow-y-auto">
                                <div class="p-2">
                                    <input type="text" id="tagSearchInput" placeholder="T√¨m th·ªÉ lo·∫°i..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div id="tagPickerList" class="p-2">
                                    <!-- Tags will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Hidden input to store selected tag IDs -->
                        <input type="hidden" name="tag_ids" id="tagIdsInput" value="">
                    </div>

                    <div class="flex gap-4 pt-4">
                        <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            üì§ T·∫£i l√™n
                        </button>
                        <button type="reset" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            X√≥a
                        </button>
                    </div>
                </form>
            </div>

            <!-- CSV Upload Section -->
            <div id="csvUploadSection" class="hidden">
                <div class="space-y-6">
                    <!-- Download Template -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-900 mb-2">üì• T·∫£i xu·ªëng m·∫´u CSV</h3>
                        <p class="text-sm text-blue-700 mb-3">T·∫£i xu·ªëng file m·∫´u CSV ƒë·ªÉ ƒëi·ªÅn th√¥ng tin truy·ªán</p>
                        <button id="downloadTemplateBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                            ‚¨áÔ∏è T·∫£i xu·ªëng m·∫´u CSV
                        </button>
                    </div>

                    <!-- Upload CSV -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ch·ªçn file CSV</label>
                        <input type="file" id="csvFileInput" accept=".csv" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">Ch·ªâ ch·∫•p nh·∫≠n file .csv v·ªõi encoding UTF-8</p>
                    </div>

                    <!-- Preview Section -->
                    <div id="csvPreviewSection" class="hidden">
                        <h3 class="font-semibold text-gray-800 mb-3">üëÅÔ∏è Xem tr∆∞·ªõc d·ªØ li·ªáu</h3>
                        <div id="csvPreview" class="overflow-x-auto border border-gray-200 rounded-lg mb-4"></div>
                        
                        <div id="csvErrors" class="hidden mb-4"></div>

                        <div class="flex gap-4">
                            <button id="importCsvBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                                ‚úÖ Nh·∫≠p d·ªØ li·ªáu
                            </button>
                            <button id="cancelCsvBtn" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                                H·ªßy
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">üìñ H∆∞·ªõng d·∫´n</h2>
            
            <div class="space-y-4 text-sm text-gray-700">
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Th√™m th·ªß c√¥ng:</h3>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>ƒêi·ªÅn th√¥ng tin truy·ªán v√†o form</li>
                        <li>C√°c tr∆∞·ªùng c√≥ d·∫•u (*) l√† b·∫Øt bu·ªôc</li>
                        <li>Nh·∫•n "T·∫£i l√™n" ƒë·ªÉ g·ª≠i</li>
                    </ul>
                </div>

                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">T·∫£i l√™n CSV:</h3>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>T·∫£i xu·ªëng file m·∫´u CSV</li>
                        <li>M·ªü file b·∫±ng Excel ho·∫∑c Google Sheets</li>
                        <li>ƒêi·ªÅn th√¥ng tin truy·ªán v√†o c√°c c·ªôt</li>
                        <li>L∆∞u file v·ªõi encoding UTF-8</li>
                        <li>T·∫£i l√™n v√† xem tr∆∞·ªõc tr∆∞·ªõc khi nh·∫≠p</li>
                    </ul>
                </div>

                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">L∆∞u √Ω:</h3>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li><strong>Th√†nh vi√™n ch·ªù duy·ªát:</strong> Kh√¥ng th·ªÉ t·∫£i l√™n truy·ªán</li>
                        <li><strong>ƒê·ªôc gi·∫£:</strong> Truy·ªán s·∫Ω ch·ªù admin duy·ªát</li>
                        <li><strong>D·ªãch gi·∫£ & Admin:</strong> Truy·ªán ƒë∆∞·ª£c duy·ªát t·ª± ƒë·ªông</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 flex items-center gap-3">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"></div>
            <span class="text-gray-700 font-medium">ƒêang x·ª≠ l√Ω...</span>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/theme-manager.js"></script>
    <script src="js/config.js"></script>
    <script src="js/database.js"></script>
    <script src="js/components.js"></script>
    <script src="js/upload.js"></script>
</body>
</html>

